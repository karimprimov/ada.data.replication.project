---
title: "data.replication.rmd"
author: "Karim Primov"
date: "3/15/2022"
output: html_document
---

Loading libraries
```{r}
library(readr)
library(gbm)
library(tidyverse)
library(ggplot2)
library(tm)
library(expm)
```


Link to the paper
https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.3000366#pbio.3000366.s007


Importing data
```{r}
library(readxl)
f <- read_excel("raw.sr.bodysize.sharkabundance.xlsx")
colnames(f)[1] <- "location"
```

Plotting densities of species richness, body size, and shark abundance:

Species Richness
```{r}
#Species Richness
sr.density <- density(f$SR, from = 0)
sr.density.plot <- plot(sr.density)
```

Body Size
```{r}
#Body Size
body.size.density <- density(f$MaxL, from = 0)
body.size.density.plot <- plot(body.size.density)
```

Shark Abundance

I cannot explain how the difference in what I get and what the publication presents for sharks abundance (not the same data used for the publication figures)
```{r}
#Shark Abundance
#shark.abund.bysite <- f %>% group_by(f$location) 
#decomposing TaSharks by doing ((e^TaSharks) -1)
fb <- f %>%
  mutate(Shark.Abundance = exp(TaSharks)-1)
a <- ggplot(fb, aes(x = Shark.Abundance)) 
a + geom_density() 

summary(fb$Shark.Abundance)
summary(fb)
```

Boosted Regression Trees

Species Richness
```{r}
#use species richness as the response variable
#boost.sp.rich.tree <- gbm(formula = fb$SR~+fb$MaxL+fb$Depth+fb$Chla_median+fb$Chla_sd+fb$SST_median+fb$SST_sd
                          +fb$pop_50km+fb$pop_500km+fb$Dist_nearest_pop+fb$Dist_nearest_market+fb$HDI+fb$Dcoast_km+
                            fb$DCoralT_km+fb$DistSeamount_km+fb$GDP+fb$Dist_SMT1500+fb$FishingEffort01+fb$FishingEffort05, data = fb, n.trees = 100000)



boost.sp.rich.tree <- gbm(formula = SR+MaxL ~+Dcoast_km+DCoralT_km+Depth+SST_median+SST_sd+DistSeamount_km,data = fb, n.trees = 100000) 
                            
                          

summary(boost.sp.rich.tree)

boost.sp.rich.tree.100x <- gbm.more(boost.sp.rich.tree, 100, verbose = FALSE)
summary(boost.sp.rich.tree.100x)

```

Body size
```{r}

```

Shark Abundance
```{r}

```


Shark Abundance Box plots (Figure 1E)
```{r}
fb$location <- gsub("[0-9]", "", as.character(f$location)) #removing numbers from location column in df "f"
shark.abund.boxplot <- boxplot(fb$Shark.Abundance~fb$location)
shark.abund.boxplot


```

```{r}
#
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```